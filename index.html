<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pozycja ISS na Mapie</title>
    <!-- Dołączanie stylów Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <h1>ISS watcher</h1>
    <p id="position">Ładowanie danych...</p><p id="direction">Ładowanie danych...</p>
    <div id="map"></div>
    <!-- pole informujące czy ISS leci na północ czy na południe -->
    

    <div id="log"></div> <!-- Obszar tekstowy do logowania pozycji -->

    <!-- Dołączanie skryptu Leaflet -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="spline.js"></script>
    <script>
        let map = L.map('map').setView([0, 0], 2);  // Ustawienie początkowego widoku mapy
        let global_latitude = 0
        let global_longitude = 0
        let global_ISS_direction = "north"
        var closestIndex = 0;
        // Ustawienia warstwy mapy OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
        }).addTo(map);

        let issMarker = L.marker([0, 0]).addTo(map);  // Utworzenie markera dla ISS
        let issPath = L.polyline([], { color: 'yellow' }).addTo(map);  // Utworzenie linii śledzenia trasy ISS
        let predictionLine = null;

        let previousPositions = [];
        let logCounter = 1; // Licznik do numerowania wierszy w logu

        // Function which finds direction of ISS
        function direction() {
            if (previousPositions.length < 2) {
                // console.log("Not enough data to determine direction");
                return;
            }

            let lastPosition = previousPositions[previousPositions.length - 1];
            let secondLastPosition = previousPositions[previousPositions.length - 2];

            if (lastPosition[0] > secondLastPosition[0]) {
                document.getElementById('direction').innerText = 'ISS is flying north';
                global_ISS_direction = "north";
            } else {
                document.getElementById('direction').innerText = 'ISS is flying south';
                global_ISS_direction = "south";
            } 
        }

        function fetchISSPosition() {
            fetch('http://api.open-notify.org/iss-now.json')
                .then(response => response.json())
                .then(data => {
                    
                    const latitude = parseFloat(data.iss_position.latitude);
                    const longitude = parseFloat(data.iss_position.longitude);

                    // Aktualizacja tekstu z pozycją
                    document.getElementById('position').innerText = 
                        `Latitude: ${latitude.toFixed(5)}, Longitude: ${longitude.toFixed(5)}`;

                    // Dodanie nowej pozycji do ścieżki
                    issPath.addLatLng([latitude, longitude]);
                    previousPositions.push([latitude, longitude]);

                    // Ograniczenie liczby przechowywanych pozycji do ostatnich 10
                    if (previousPositions.length > 10) {
                        previousPositions.shift();
                    }

                    // Aktualizacja pozycji markera na mapie
                    issMarker.setLatLng([latitude, longitude]);

                    // Przesunięcie widoku mapy na nową pozycję ISS
                    // map.setView([latitude, longitude], map.getZoom());

                    // Dodanie nowego wiersza do logu
                    const logEntry = `{ "id": ${logCounter}, "latitude": ${latitude.toFixed(5)}, "longitude": ${longitude.toFixed(5)}},`;
                    document.getElementById('log').innerHTML += logEntry + '<br>';
                    global_latitude = latitude.toFixed(2)
                    global_longitude = longitude.toFixed(2)
                    logCounter++;

                    
                })
                .catch(error => {
                    document.getElementById('position').innerText = 
                        'Błąd ładowania danych: ' + error.message;
                });
        }
        
        // Odświeżaj dane co 1 sekundę
        setInterval(fetchISSPosition, 1000);

        // Pierwsze wywołanie funkcji, aby dane załadowały się od razu
        fetchISSPosition();

        // const Spline = require('./spline');

        // Historical data for ISS moving north 
        const xs_north = [ -51.60, -51.55, -51.18, -50.48, -49.48, -48.20, -46.67, -44.92, -42.96, -40.82, -38.53, -36.10, -33.56, -30.95, -28.23, -25.44, -22.59, -19.69, -16.78, -13.81, -12.56, -12.51, -12.46, -12.41, -12.36, -12.31, -12.26, -12.21, -12.16, -12.11, -12.06, -12.01, -11.94, -11.91, -11.86, -11.81, -11.76, -11.71, -11.66, -11.61, -11.56, -11.51, -11.46, -11.41, -11.36, -11.31, -11.26, -11.21, -11.16, -11.11, -11.06, -11.01, -10.96, -10.91, -10.81, -10.76, -10.71, -10.66, -10.61, -10.56, -10.51, -10.46, -10.41, -10.36, -10.31, -10.26, -10.21, -10.16, -10.11, -10.05, -10.00, -9.95, -9.90, -9.85, -9.80, -9.75, -9.70, -9.65, -9.60, -9.55, -9.50, -9.45, -9.40, -9.35, -9.30, -9.25, -9.20, -9.15, -9.10, -9.05, -9.00, -8.95, -8.90, -8.85, -8.80, -8.75, -8.70, -8.65, -8.60, -8.55, -8.49, -8.44, -8.39, -8.34, -8.29, -8.24, -8.19, -8.14, -8.09, -8.04, -7.99, -7.94, -7.89, -7.79, -4.78, -1.74, 1.31, 4.35, 7.38, 10.38, 13.38, 16.36, 19.09, 19.11, 19.16, 19.21, 19.26, 19.31, 19.35, 19.40, 19.45, 19.50, 19.57, 19.60, 19.65, 19.70, 19.74, 19.79, 19.84, 19.89, 19.94, 19.99, 20.04, 20.08, 20.13, 20.18, 20.23, 20.28, 20.33, 20.38, 20.42, 20.47, 20.52, 20.57, 20.62, 20.67, 20.72, 20.76, 20.81, 20.86, 20.91, 20.96, 21.01, 21.10, 21.15, 21.20, 21.25, 21.30, 21.34, 21.39, 21.44, 21.49, 21.54, 21.59, 21.63, 21.68, 21.73, 21.78, 21.83, 21.87, 21.92, 21.97, 22.02, 22.07, 22.11, 22.16, 22.21, 22.26, 22.31, 22.35, 22.40, 22.45, 22.50, 22.55, 22.59, 22.64, 22.67, 22.69, 22.74, 22.79, 22.83, 22.93, 22.98, 23.03, 23.07, 23.12, 23.17, 23.22, 23.26, 23.31, 23.36, 23.41, 23.45, 23.50, 23.55, 23.60, 23.65, 23.69, 23.74, 23.79, 23.84, 23.88, 23.93, 23.98, 24.03, 24.07, 24.12, 24.17, 24.22, 24.26, 24.29, 24.33, 24.45, 24.48, 24.52, 24.57, 24.62, 24.67, 24.71, 24.76, 24.81, 24.85, 24.90, 24.95, 25.00, 25.04, 25.09, 25.14, 25.18, 25.23, 25.28, 25.33, 25.37, 25.42, 25.47, 25.51, 25.56, 25.61, 25.66, 25.70, 27.84, 30.57, 30.58, 30.63, 30.67, 30.72, 30.76, 30.81, 30.85, 30.90, 30.94, 30.99, 31.03, 31.07, 31.12, 31.16, 31.21, 31.25, 31.30, 31.39, 31.43, 31.48, 31.52, 31.56, 31.59, 31.63, 31.65, 31.70, 31.74, 31.79, 31.83, 31.87, 31.92, 31.96, 32.01, 32.05, 32.09, 32.14, 32.18, 32.23, 32.27, 32.31, 32.36, 32.40, 32.45, 32.49, 32.53, 32.58, 32.62, 32.67, 32.71, 32.75, 32.80, 32.84, 32.88, 32.93, 32.97, 33.01, 33.06, 33.10, 33.14, 33.19, 33.23, 33.27, 33.32, 33.36, 33.45, 33.49, 33.51, 33.56, 33.60, 33.64, 33.71, 33.73, 33.77, 33.81, 33.86, 33.90, 33.97, 33.99, 34.03, 34.07, 34.12, 34.16, 34.20, 34.24, 34.29, 34.33, 34.37, 34.41, 34.46, 34.50, 34.54, 34.59, 34.63, 34.67, 34.71, 34.75, 34.80, 34.84, 34.88, 34.92, 34.97, 35.01, 35.05, 35.09, 35.14, 35.18, 35.22, 35.26, 35.30, 35.35, 35.39, 35.43, 35.47, 35.51, 35.56, 35.60, 35.64, 35.68, 35.72, 35.76, 35.81, 35.85, 35.87, 35.91, 35.97, 36.01, 36.06, 36.10, 36.14, 36.18, 36.22, 36.26, 36.30, 36.34, 36.39, 36.43, 36.47, 36.51, 36.55, 36.59, 36.61, 36.65, 36.69, 36.74, 36.78, 36.82, 36.86, 36.92, 36.96, 37.02, 37.04, 37.08, 37.12, 37.16, 37.20, 37.24, 37.29, 37.33, 37.37, 37.41, 37.45, 37.49, 37.53, 37.57, 37.61, 37.65, 37.69, 37.73, 37.77, 37.81, 37.85, 37.89, 37.93, 37.97, 38.01, 38.05, 38.09, 38.13, 38.17, 38.21, 38.25, 38.29, 38.33, 38.37, 38.41, 38.44, 38.48, 38.52, 38.56, 38.60, 38.64, 38.68, 38.70, 38.72, 38.76, 38.80, 38.84, 38.88, 38.92, 38.95, 39.01, 39.03, 39.07, 39.11, 39.15, 39.19, 39.27, 39.30, 39.32, 39.34, 39.38, 39.42, 39.46, 39.50, 39.54, 39.61, 39.69, 39.73, 39.77, 39.80, 39.84, 39.88, 39.92, 39.96, 39.99, 40.03, 40.07, 40.11, 40.15, 40.18, 40.22, 40.26, 40.30, 40.33, 40.37, 40.41, 40.45, 40.48, 40.52, 40.56, 40.60, 40.63, 40.67, 40.71, 40.74, 40.82, 40.86, 40.89, 40.93, 40.97, 41.00, 41.04, 41.08, 41.11, 41.15, 41.19, 41.22, 41.26, 41.30, 41.33, 41.37, 41.41, 41.44, 41.48, 41.51, 41.55, 41.59, 41.62, 41.66, 41.69, 41.73, 41.77, 41.80, 41.84, 41.87, 41.91, 41.95, 41.98, 42.02, 42.05, 42.09, 42.12, 42.16, 42.19, 42.23, 42.26, 42.30, 42.33, 42.37, 42.40, 42.44, 42.47, 42.51, 42.54, 42.58, 42.61, 42.65, 42.68, 42.72, 42.75, 42.79, 42.82, 42.86, 42.89, 44.35, 44.63, 44.64, 44.67, 44.70, 44.74, 44.77, 44.80, 44.83, 44.86, 44.89, 44.92, 44.96, 44.99, 45.02, 45.05, 45.08, 45.13, 45.16, 45.19, 45.22, 45.25, 45.28, 45.31, 45.34, 45.37, 45.40, 45.43, 45.46, 45.49, 45.52, 45.55, 45.58, 45.61, 45.64, 45.67, 45.70, 45.73, 45.74, 45.77, 45.80, 45.83, 45.86, 45.93, 45.96, 45.99, 46.02, 46.05, 46.08, 46.12, 46.17, 46.19, 46.22, 46.25, 46.28, 46.31, 46.34, 46.37, 46.39, 46.42, 46.45, 46.48, 46.51, 46.53, 46.56, 46.60, 46.63, 46.67, 46.70, 46.73, 46.75, 46.78, 46.81, 46.84, 46.86, 46.89, 46.92, 46.96, 47.00, 47.03, 47.05, 47.08, 47.11, 47.13, 47.16, 47.21, 47.24, 47.26, 47.29, 47.34, 47.37, 47.39, 47.42, 47.44, 47.47, 47.50, 47.52, 47.55, 47.77, 49.13, 50.22, 51.00, 51.47, 51.53, 51.54, 51.55, 51.56, 51.57, 51.58, 51.59, 51.60, 51.61, 51.62 ];  // example x values
        const ys_north = [ -37.15, -31.16, -25.27, -19.48, -13.90, -8.58, -3.56, 1.11, 5.51, 9.61, 13.42, 16.98, 20.31, 23.40, 26.34, 29.11, 31.75, 34.27, 36.66, 39.00, 39.96, 39.99, 40.03, 40.07, 40.11, 40.15, 40.18, 40.22, 40.26, 40.30, 40.33, 40.37, 40.43, 40.45, 40.49, 40.52, 40.56, 40.60, 40.64, 40.67, 40.71, 40.75, 40.79, 40.82, 40.86, 40.90, 40.94, 40.98, 41.01, 41.05, 41.09, 41.13, 41.16, 41.20, 41.27, 41.31, 41.35, 41.39, 41.42, 41.46, 41.50, 41.54, 41.57, 41.61, 41.65, 41.69, 41.72, 41.76, 41.80, 41.83, 41.87, 41.91, 41.95, 41.98, 42.02, 42.06, 42.09, 42.13, 42.17, 42.21, 42.24, 42.28, 42.32, 42.35, 42.39, 42.43, 42.47, 42.50, 42.54, 42.58, 42.61, 42.65, 42.69, 42.72, 42.76, 42.80, 42.83, 42.87, 42.91, 42.95, 42.98, 43.02, 43.06, 43.09, 43.13, 43.17, 43.20, 43.24, 43.28, 43.31, 43.35, 43.39, 43.42, 43.50, 45.67, 47.83, 49.99, 52.15, 54.34, 56.53, 58.80, 61.13, 63.35, 63.37, 63.41, 63.45, 63.50, 63.54, 63.58, 63.62, 63.66, 63.70, 63.76, 63.78, 63.82, 63.86, 63.91, 63.95, 63.99, 64.03, 64.07, 64.11, 64.15, 64.19, 64.24, 64.28, 64.32, 64.36, 64.40, 64.44, 64.48, 64.53, 64.57, 64.61, 64.65, 64.69, 64.73, 64.78, 64.82, 64.86, 64.90, 64.94, 64.98, 65.07, 65.11, 65.15, 65.19, 65.24, 65.28, 65.32, 65.36, 65.40, 65.45, 65.49, 65.53, 65.57, 65.62, 65.66, 65.70, 65.74, 65.79, 65.83, 65.87, 65.91, 65.96, 66.00, 66.04, 66.08, 66.13, 66.17, 66.21, 66.25, 66.30, 66.34, 66.38, 66.43, 66.45, 66.47, 66.51, 66.56, 66.60, 66.68, 66.73, 66.77, 66.81, 66.86, 66.90, 66.94, 66.99, 67.03, 67.07, 67.12, 67.16, 67.21, 67.25, 67.29, 67.34, 67.38, 67.42, 67.47, 67.51, 67.55, 67.60, 67.64, 67.69, 67.73, 67.77, 67.82, 67.86, 67.91, 67.93, 67.97, 68.08, 68.11, 68.15, 68.19, 68.24, 68.28, 68.33, 68.37, 68.42, 68.46, 68.51, 68.55, 68.59, 68.64, 68.68, 68.73, 68.77, 68.82, 68.86, 68.91, 68.95, 69.00, 69.04, 69.09, 69.13, 69.18, 69.22, 69.27, 71.40, 74.31, 74.41, 74.46, 74.51, 74.56, 74.61, 74.66, 74.71, 74.76, 74.81, 74.86, 74.91, 74.97, 75.02, 75.07, 75.12, 75.17, 75.22, 75.32, 75.37, 75.42, 75.47, 75.52, 75.55, 75.60, 75.63, 75.68, 75.73, 75.78, 75.83, 75.88, 75.94, 75.99, 76.04, 76.09, 76.14, 76.19, 76.25, 76.30, 76.35, 76.40, 76.45, 76.51, 76.56, 76.61, 76.66, 76.71, 76.77, 76.82, 76.87, 76.92, 76.98, 77.03, 77.08, 77.14, 77.19, 77.24, 77.29, 77.35, 77.40, 77.45, 77.51, 77.56, 77.61, 77.67, 77.77, 77.83, 77.85, 77.91, 77.96, 78.02, 78.10, 78.12, 78.18, 78.23, 78.28, 78.34, 78.42, 78.45, 78.50, 78.56, 78.61, 78.66, 78.72, 78.77, 78.83, 78.88, 78.94, 78.99, 79.05, 79.10, 79.16, 79.21, 79.27, 79.32, 79.38, 79.43, 79.49, 79.54, 79.60, 79.65, 79.71, 79.77, 79.82, 79.88, 79.93, 79.99, 80.05, 80.10, 80.16, 80.21, 80.27, 80.33, 80.38, 80.44, 80.50, 80.55, 80.61, 80.67, 80.72, 80.78, 80.84, 80.89, 80.92, 80.98, 81.06, 81.12, 81.18, 81.24, 81.29, 81.35, 81.41, 81.47, 81.52, 81.58, 81.64, 81.70, 81.75, 81.81, 81.87, 81.93, 81.96, 82.02, 82.07, 82.13, 82.19, 82.25, 82.31, 82.40, 82.45, 82.54, 82.57, 82.63, 82.69, 82.75, 82.81, 82.87, 82.93, 82.99, 83.04, 83.10, 83.16, 83.22, 83.28, 83.34, 83.40, 83.46, 83.52, 83.58, 83.64, 83.70, 83.76, 83.82, 83.88, 83.94, 84.00, 84.06, 84.13, 84.19, 84.25, 84.31, 84.37, 84.43, 84.49, 84.55, 84.61, 84.67, 84.74, 84.80, 84.86, 84.92, 84.98, 85.04, 85.07, 85.10, 85.17, 85.23, 85.29, 85.35, 85.41, 85.48, 85.57, 85.60, 85.66, 85.73, 85.79, 85.85, 85.98, 86.04, 86.07, 86.10, 86.17, 86.23, 86.29, 86.36, 86.42, 86.55, 86.67, 86.74, 86.80, 86.86, 86.93, 86.99, 87.06, 87.12, 87.18, 87.25, 87.31, 87.38, 87.44, 87.51, 87.57, 87.64, 87.70, 87.77, 87.83, 87.90, 87.96, 88.03, 88.09, 88.16, 88.22, 88.29, 88.35, 88.42, 88.49, 88.62, 88.68, 88.75, 88.82, 88.88, 88.95, 89.01, 89.08, 89.15, 89.21, 89.28, 89.35, 89.41, 89.48, 89.55, 89.62, 89.68, 89.75, 89.82, 89.88, 89.95, 90.02, 90.09, 90.15, 90.22, 90.29, 90.36, 90.43, 90.49, 90.56, 90.63, 90.70, 90.77, 90.84, 90.91, 90.97, 91.04, 91.11, 91.18, 91.25, 91.32, 91.39, 91.46, 91.53, 91.60, 91.67, 91.74, 91.81, 91.87, 91.94, 92.01, 92.08, 92.15, 92.23, 92.30, 92.37, 92.44, 92.51, 92.58, 95.77, 96.40, 96.44, 96.52, 96.59, 96.67, 96.74, 96.82, 96.89, 96.97, 97.05, 97.12, 97.20, 97.27, 97.35, 97.43, 97.50, 97.62, 97.69, 97.77, 97.85, 97.92, 98.00, 98.08, 98.15, 98.23, 98.31, 98.39, 98.46, 98.54, 98.62, 98.70, 98.77, 98.85, 98.93, 99.01, 99.09, 99.16, 99.20, 99.28, 99.36, 99.44, 99.52, 99.71, 99.79, 99.87, 99.95, 100.03, 100.11, 100.23, 100.35, 100.43, 100.51, 100.59, 100.67, 100.75, 100.83, 100.91, 100.99, 101.07, 101.15, 101.23, 101.31, 101.39, 101.47, 101.59, 101.67, 101.79, 101.88, 101.96, 102.04, 102.12, 102.20, 102.28, 102.36, 102.45, 102.53, 102.65, 102.77, 102.86, 102.94, 103.02, 103.10, 103.19, 103.27, 103.44, 103.52, 103.60, 103.68, 103.85, 103.93, 104.02, 104.10, 104.18, 104.27, 104.35, 104.44, 104.52, 105.28, 110.51, 116.03, 121.77, 127.63, 128.82, 128.97, 129.27, 129.57, 129.87, 130.17, 130.57, 130.92, 131.52, 133.37 ]; // example y values
        const xs_south = [ 51.62, 51.62, 51.62, 51.62, 51.61, 51.61, 51.61, 51.61, 51.61, 51.61, 51.61, 51.60, 51.60, 51.60, 51.60, 51.60, 51.59, 51.59, 51.59, 51.59, 51.59, 51.58, 51.58, 51.58, 51.57, 51.57, 51.57, 51.57, 51.56, 51.56, 51.56, 51.55, 51.55, 51.54, 51.54, 51.54, 51.53, 51.53, 51.52, 51.52, 51.52, 51.51, 51.51, 51.50, 51.50, 51.49, 51.49, 51.48, 51.48, 51.47, 51.46, 51.46, 51.45, 51.45, 51.44, 51.43, 51.43, 51.42, 51.42, 51.41, 51.40, 51.40, 51.39, 51.38, 51.38, 51.37, 51.36, 51.36, 51.35, 51.34, 51.34, 51.33, 51.32, 51.31, 51.31, 51.30, 51.29, 51.28, 51.28, 51.27, 51.26, 51.25, 51.24, 51.23, 51.23, 51.22, 51.21, 51.20, 51.19, 51.18, 51.17, 51.16, 51.16, 51.15, 51.14, 51.13, 51.12, 51.11, 51.10, 51.09, 51.08, 51.07, 51.06, 51.05, 51.04, 51.03, 51.02, 51.01, 51.00, 50.92, 50.09, 48.98, 47.59, 45.96, 44.11, 42.06, 39.87, 37.52, 35.04, 32.46, 29.78, 27.06, 24.24, 21.37, 18.45, 15.50, 12.54, 9.53, 6.50, 3.46, 0.41, -2.60, -5.65, -8.68, -11.69, -14.68, -17.62, -20.55, -23.43, -26.26, -29.03, -31.71, -34.32, -36.82, -39.21, -41.46, -43.54, -45.45, -47.15, -48.61, -49.81, -50.71, -51.32, -51.60 ]
        const ys_south = [ 7.52, 7.62, 7.72, 7.82, 7.92, 8.02, 8.12, 8.22, 8.32, 8.42, 8.52, 8.62, 8.72, 8.82, 8.92, 9.02, 9.12, 9.22, 9.32, 9.42, 9.52, 9.62, 9.72, 9.82, 9.92, 10.02, 10.12, 10.22, 10.32, 10.42, 10.52, 10.62, 10.72, 10.82, 10.92, 11.02, 11.11, 11.21, 11.31, 11.41, 11.51, 11.61, 11.71, 11.81, 11.91, 12.01, 12.11, 12.21, 12.31, 12.41, 12.61, 12.71, 12.81, 12.90, 13.00, 13.10, 13.20, 13.30, 13.40, 13.50, 13.60, 13.70, 13.80, 13.90, 14.00, 14.09, 14.19, 14.29, 14.39, 14.49, 14.59, 14.69, 14.79, 14.88, 14.98, 15.08, 15.18, 15.28, 15.38, 15.48, 15.57, 15.67, 15.77, 15.87, 15.97, 16.07, 16.16, 16.26, 16.36, 16.46, 16.56, 16.65, 16.75, 16.85, 16.95, 17.05, 17.14, 17.24, 17.34, 17.44, 17.54, 17.63, 17.73, 17.83, 17.93, 18.02, 18.12, 18.22, 18.31, 18.99, 24.71, 30.15, 35.35, 40.24, 44.82, 49.09, 53.04, 56.75, 60.21, 63.44, 66.48, 69.32, 72.04, 74.62, 77.10, 79.48, 81.77, 84.02, 86.23, 88.41, 90.57, 92.71, 94.88, 97.08, 99.31, 101.60, 103.94, 106.39, 108.94, 111.62, 114.44, 117.40, 120.57, 123.96, 127.60, 131.49, 135.64, 140.13, 144.93, 150.04, 155.44, 161.04, 166.88, 172.85 ]

        const ys_with_offset = [];
        const xs_with_offset = [];

        const xs = []
        const ys = []

        // Adjust data for xs and ys according to dierction of ISS
        function adjustDirection(xs, ys, direction) {
            // direction()
            xs.length = 0;
            ys.length = 0;
            if (direction == 'north') {
                for (var i = 0; i < xs_north.length; i++) {
                    xs.push(xs_north[i]);
                    ys.push(ys_north[i]);
                }
            } else {
                for (var i = 0; i < xs_south.length; i++) {
                    xs.push(xs_south[i]);
                    ys.push(ys_south[i]);
                }
            }
        }
        
        function findClosestIndex(array, targetValue) {
            var closestIndex = 0;
            var closestDifference = Math.abs(array[0] - targetValue);

            for (var i = 1; i < array.length; i++) {
                var currentDifference = Math.abs(array[i] - targetValue);

                if (currentDifference < closestDifference) {
                    closestDifference = currentDifference;
                    closestIndex = i;
                }
            }

            return closestIndex;
        }

        // const spline = new Spline(xs_north, ys_north);

        // Aktualizacja linii przewidywania ścieżki ISS
        function updatePredictionLine() {
            direction();
            adjustDirection(xs, ys, global_ISS_direction);
            closestIndex = findClosestIndex(xs, global_latitude);
            ys_with_offset.length = 0;
            xs_with_offset.length = 0;
            var longitude_offset = global_longitude - ys[closestIndex];
            // for (var i = 0; i < ys.length; i++) {
            //     ys_with_offset.push(ys[i] + longitude_offset);
            // }
            for (var i = closestIndex; i < ys.length; i++) {
                ys_with_offset.push(ys[i] + longitude_offset);
            }


            for (var i = closestIndex; i < xs.length; i++) {
                xs_with_offset.push(xs[i]);
            }
            
            
            var latlngs = [];
                    for (var i = 0; i < xs_with_offset.length; i++) {
                        latlngs.push([xs_with_offset[i], ys_with_offset[i]]);
                    }
                        if (predictionLine) {
                            predictionLine.remove();
            } 


            // var latlngs = [];
            //         for (var i = 0; i < xs.length; i++) {
            //             latlngs.push([xs[i], ys_with_offset[i]]);
            //         }
            //             if (predictionLine) {
            //                 predictionLine.remove();
            // }
                    // Dodanie linii (polyline) przechodzącej przez wszystkie punkty

            predictionLine = L.polyline(latlngs, {color: 'green'}).addTo(map);

            

            // global_longitude = spline.at(global_latitude);
            }

        setInterval(updatePredictionLine, 1000);

        // Użycie danych z coordinates.json do obliczenia algorytmu przewidywania ścieżki ISS na podstawie ostatnich 10 pozycji
            
    </script>
</body>
</html>